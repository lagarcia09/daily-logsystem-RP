@page
@model DailyLogSystem.Pages.AdminAttendanceModel
@{
    ViewData["Title"] = "Attendance Oversight";
    
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>@ViewData["Title"] - Admin</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            box-sizing: border-box;
        }
    </style>

    <script>
        function logoutUser() {
            if (confirm("Are you sure you want to logout?")) {
                window.location.href = "/Logout";
            }
        }
    </script>
</head>

<body class="min-h-screen" style="background-color:#5D866C;">

    <!-- NAVIGATION BAR -->
    <nav style="background-color: #C2A68C; border-bottom: 2px solid #E6D8C3;"
         class="shadow-lg">

        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">

                <img src="/images/WFH DLS LOGO.png"
                     alt="System Logo"
                     class="w-24 h-24 object-contain" />

                <div class="text-3xl font-bold" style="color:#5D866C;">
                    Admin Dashboard
                </div>

                <div class="flex space-x-2">
                    <a asp-page="/AdminOverview"
                       class="px-6 py-3 rounded-xl transition-all duration-300 font-semibold shadow-lg"
                       style="background-color:#5D866C; color:#F5F5F0; border:2px solid #C2A68C;">
                        📊 Overview
                    </a>

                    <a asp-page="/AdminEmployees"
                       class="px-6 py-3 rounded-xl transition-all duration-300 font-semibold shadow-lg"
                       style="background-color:#E6D8C3; color:#5D866C; border:2px solid #C2A68C;">
                        👥 Employees
                    </a>

                    <a asp-page="/AdminAttendance"
                       class="px-6 py-3 rounded-xl transition-all duration-300 font-semibold shadow-lg"
                       style="background-color:#E6D8C3; color:#5D866C; border:2px solid #C2A68C;">
                        🕒 Attendance
                    </a>

                    <a asp-page="/AdminReports"
                       class="px-6 py-3 rounded-xl transition-all duration-300 font-semibold shadow-lg"
                       style="background-color:#E6D8C3; color:#5D866C; border:2px solid #C2A68C;">
                        📄 Reports
                    </a>

                    <button onclick="logoutUser()"
                            class="px-6 py-3 rounded-xl transition-all duration-300 font-semibold shadow-lg"
                            style="background-color:#E6D8C3; color:#5D866C; border:2px solid #C2A68C;">
                        🚪 Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- PAGE BODY -->
    <div class="max-w-7xl mx-auto p-8">

        <div class="max-w-6xl mx-auto p-6">
            <h2 class="text-2xl font-bold mb-4" style="color:#5D866C;">Attendance Oversight</h2>

            <form method="get" class="mb-4">

                <input type="date"
                       name="SelectedDate"
                       value="@(Model.SelectedDate?.ToString("yyyy-MM-dd"))"
                       class="p-3 border rounded-xl w-full mb-2" />

                <select name="StatusFilter" class="p-3 border rounded-xl w-full mb-2">
                    <option value="">All</option>
                    <option>ABSENT</option>
                    <option>LATE</option>
                    <option>UNDERTIME</option>
                    <option>OVERTIME</option>
                    <option>ON TIME</option>
                </select>

                <button type="submit"
                        class="px-6 py-3 rounded-xl font-semibold shadow-lg"
                        style="background:#5D866C; color:#F5F5F0;">
                    🔍 Filter
                </button>
            </form>

            @if (!string.IsNullOrEmpty(TempData["SuccessMessage"] as string))
            {
                <div class="mb-4 p-3 rounded" style="background:#D1FAE5; color:#065F46;">
                    @TempData["SuccessMessage"]
                </div>
            }

            <table class="w-full text-left">
                <thead>
                    <tr class="border-b">
                        <th>Date</th>
                        <th>Employee</th>
                        <th>Status</th>
                        <th>Time In</th>
                        <th>Time Out</th>
                        <th>Hours</th>
                        <th>Overtime</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var log in Model.AttendanceLogs)
                    {
                        <tr class="border-b">
                            <td>@log.Date.ToString("MMM dd, yyyy")</td>
                            <td>@(string.IsNullOrWhiteSpace(log.DisplayName) ? "Unknown" : log.DisplayName)</td>
                            <td>@log.Status</td>
                            <td>@(log.TimeIn.HasValue ? log.TimeIn.Value.ToString("yyyy-MM-dd HH:mm") : "-")</td>
                            <td>@(log.TimeOut.HasValue ? log.TimeOut.Value.ToString("yyyy-MM-dd HH:mm") : "-")</td>
                            <td>@log.TotalHours</td>
                            <td>@log.OvertimeHours</td>
                            <td>
                                <button type="button"
                                        class="px-3 py-1 rounded shadow-sm"
                                        style="background:#C2A68C; color:white;"
                                        onclick="openEditModal('@log.Id', '@(log.Date.ToString("yyyy-MM-dd"))', '@(log.TimeIn?.ToString("yyyy-MM-ddTHH:mm"))', '@(log.TimeOut?.ToString("yyyy-MM-ddTHH:mm"))', '@log.Status', '@log.OvertimeHours')">
                                    Edit
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

    </div>

    <!-- EDIT MODAL -->
    <div id="editModal"
         class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50">
        <div class="bg-white p-6 rounded-xl w-[520px] shadow-lg">
            <h2 class="text-xl font-semibold mb-3" style="color:#5D866C;">Edit Attendance</h2>

            <form method="post" asp-page-handler="EditAttendance" id="editAttendanceForm">

                <input type="hidden" id="edit_id" name="id" />

                <label class="block mb-1 font-semibold">Date</label>
                <input id="edit_date" type="date" name="date"
                       class="w-full p-3 border rounded-xl mb-3" readonly />

                <label class="block mb-1 font-semibold">Time In</label>
                <input id="edit_timein" name="timeIn" type="datetime-local"
                       class="w-full p-3 border rounded-xl mb-3" />

                <label class="block mb-1 font-semibold">Time Out</label>
                <input id="edit_timeout" name="timeOut" type="datetime-local"
                       class="w-full p-3 border rounded-xl mb-3" />

                <label class="block mb-1 font-semibold">Status</label>
                <select id="edit_status" name="status"
                        class="w-full p-3 border rounded-xl mb-3">
                    <option>ON TIME</option>
                    <option>LATE</option>
                    <option>ABSENT</option>
                    <option>UNDERTIME</option>
                    <option>OVERTIME</option>
                </select>

                <label class="block mb-1 font-semibold">Overtime Hours</label>
                <input id="edit_overtime" name="overtime" type="text"
                       class="w-full p-3 border rounded-xl mb-4" />

                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeEditModal()"
                            class="px-4 py-2 bg-gray-300 rounded-xl">
                        Cancel
                    </button>

                    <button type="submit"
                            class="px-4 py-2 rounded-xl text-white"
                            style="background:#5D866C;">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openEditModal(id, date, timeIn, timeOut, status, overtime) {
            document.getElementById('edit_id').value = id;
            document.getElementById('edit_date').value = date;
            document.getElementById('edit_timein').value = timeIn || "";
            document.getElementById('edit_timeout').value = timeOut || "";
            document.getElementById('edit_status').value = status;
            document.getElementById('edit_overtime').value = overtime || "";

            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        }
    </script>

</body>
</html>
